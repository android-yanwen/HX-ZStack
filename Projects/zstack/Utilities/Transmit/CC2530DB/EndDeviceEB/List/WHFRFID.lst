###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.20.2.41139 for 8051             09/Sep/2014  13:39:22 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  C:\Documents and Settings\Administrator\×ÀÃæ\ZSTAC #
#                          K-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Utiliti #
#                          es\Transmit\Source\WHFRFID.c                       #
#    Command line       =  -f "C:\Documents and Settings\Administrator\×ÀÃæ\Z #
#                          STACK-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Uti #
#                          lities\Transmit\CC2530DB\..\..\..\Tools\CC2530DB\f #
#                          8wEndev.cfg" (-DCPU32MHZ -DROOT=__near_func        #
#                          -DMAC_CFG_TX_DATA_MAX=3 -DMAC_CFG_TX_MAX=6         #
#                          -DMAC_CFG_RX_MAX=3) -f "C:\Documents and           #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg"         #
#                          (-DZIGBEEPRO -DSECURE=0 -DZG_SECURE_DYNAMIC=0      #
#                          -DREFLECTOR -DDEFAULT_CHANLIST=0x00001000          #
#                          -DZDAPP_CONFIG_PAN_ID=0x1178                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=3             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=2    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=TRUE -DPOLL_RATE=1000         #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Documents and           #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\Sourc #
#                          e\WHFRFID.c" -D NWK_AUTO_POLL -D MT_TASK -D        #
#                          ZTOOL_P1 -D MT_SYS_FUNC -D MT_ZDO_FUNC -D          #
#                          ZDNWKMGR_MIN_TRANSMISSIONS=0 -D GTA_DEBUG -D       #
#                          ZIGBEEPRO -lC "C:\Documents and                    #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\EndDeviceEB\List\" -lA "C:\Documents and       #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\EndDeviceEB\List\" --diag_suppress             #
#                          Pe001,Pa010 -o "C:\Documents and                   #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\EndDeviceEB\Obj\" -e --no_code_motion --debug  #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "C:\Documents and          #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\" -I "C:\Documents and                         #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\..\Source\" -I "C:\Documents and               #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\..\..\..\ZMain\TI2530DB\" -I "C:\Documents     #
#                          and Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö #
#                          ÷¶¯ÉÏ´«140707\Projects\zstack\Utilities\Transmit\C #
#                          C2530DB\..\..\..\..\..\Components\hal\include\"    #
#                          -I "C:\Documents and Settings\Administrator\×ÀÃæ\Z #
#                          STACK-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Uti #
#                          lities\Transmit\CC2530DB\..\..\..\..\..\Components #
#                          \hal\target\CC2530EB\" -I "C:\Documents and        #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\..\..\..\..\..\Components\mac\include\" -I     #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\ZSTA #
#                          CK-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Utilit #
#                          ies\Transmit\CC2530DB\..\..\..\..\..\Components\ma #
#                          c\high_level\" -I "C:\Documents and                #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\..\..\..\..\..\Components\mac\low_level\srf04\ #
#                          " -I "C:\Documents and Settings\Administrator\×ÀÃæ #
#                          \ZSTACK-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\U #
#                          tilities\Transmit\CC2530DB\..\..\..\..\..\Componen #
#                          ts\mac\low_level\srf04\single_chip\" -I            #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\ZSTA #
#                          CK-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Utilit #
#                          ies\Transmit\CC2530DB\..\..\..\..\..\Components\mt #
#                          \" -I "C:\Documents and Settings\Administrator\×ÀÃ #
#                          æ\ZSTACK-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\ #
#                          Utilities\Transmit\CC2530DB\..\..\..\..\..\Compone #
#                          nts\osal\include\" -I "C:\Documents and            #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\..\..\..\..\..\Components\services\saddr\" -I  #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\ZSTA #
#                          CK-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Utilit #
#                          ies\Transmit\CC2530DB\..\..\..\..\..\Components\se #
#                          rvices\sdata\" -I "C:\Documents and                #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\..\..\..\..\..\Components\stack\af\" -I        #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\ZSTA #
#                          CK-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Utilit #
#                          ies\Transmit\CC2530DB\..\..\..\..\..\Components\st #
#                          ack\nwk\" -I "C:\Documents and                     #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\..\..\..\..\..\Components\stack\sapi\" -I      #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\ZSTA #
#                          CK-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Utilit #
#                          ies\Transmit\CC2530DB\..\..\..\..\..\Components\st #
#                          ack\sec\" -I "C:\Documents and                     #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\..\..\..\..\..\Components\stack\sys\" -I       #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\ZSTA #
#                          CK-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Utilit #
#                          ies\Transmit\CC2530DB\..\..\..\..\..\Components\st #
#                          ack\zdo\" -I "C:\Documents and                     #
#                          Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯É #
#                          Ï´«140707\Projects\zstack\Utilities\Transmit\CC253 #
#                          0DB\..\..\..\..\..\Components\zmac\" -I            #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\ZSTA #
#                          CK-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Utilit #
#                          ies\Transmit\CC2530DB\..\..\..\..\..\Components\zm #
#                          ac\f8w\" -Ohz --require_prototypes                 #
#    List file          =  C:\Documents and Settings\Administrator\×ÀÃæ\ZSTAC #
#                          K-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Utiliti #
#                          es\Transmit\CC2530DB\EndDeviceEB\List\WHFRFID.lst  #
#    Object file        =  C:\Documents and Settings\Administrator\×ÀÃæ\ZSTAC #
#                          K-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Utiliti #
#                          es\Transmit\CC2530DB\EndDeviceEB\Obj\WHFRFID.r51   #
#                                                                             #
#                                                                             #
###############################################################################

C:\Documents and Settings\Administrator\×ÀÃæ\ZSTACK-GTAMODBUS-Ö÷¶¯ÉÏ´«140707\Projects\zstack\Utilities\Transmit\Source\WHFRFID.c
      1          
      2          #if defined (GTA_WHFRFID_R1)
      3          #include "WHFRFID.h"
      4          //#include "hal_defs.h"
      5          #include "ZComDef.h"
      6          unsigned int PackUpRC623Data(unsigned int cmd,unsigned char *pdata,unsigned char *pframe)    
      7          {
      8            unsigned int datalen=0;
      9            unsigned char i=0;
     10            unsigned char crc=0;
     11            pframe[0]=0xAA;
     12            pframe[1]=0xBB;
     13            pframe[4]=DEV_DESC_H;
     14            crc^=pframe[4];
     15            pframe[5]=DEV_DESC_L;
     16            crc^=pframe[5];
     17            pframe[6]=LO_UINT16(cmd);
     18            crc^=pframe[6];
     19            pframe[7]=HI_UINT16(cmd);
     20            crc^=pframe[7];
     21            switch(cmd)
     22            {
     23            case RFID_CMD_SET_ISOTYPE:
     24              datalen=1;
     25              break;
     26            case RFID_CMD_SELECT_CARD:
     27              datalen=4;
     28              break;
     29            case RFID_CMD_GET_CARD_ID:
     30              datalen=1;
     31              break;
     32            case RFID_CMD_FIND_ISO14443_CARD:
     33              datalen=1;
     34              break;
     35            case RFID_CMD_CONFIG_KEY:
     36              datalen=8;
     37              break;
     38            case RFID_CMD_READ_VAL:
     39              datalen=1;
     40              break;
     41            default:
     42              return -1;
     43            }
     44            pframe[2]=LO_UINT16(datalen+5);
     45            pframe[3]=HI_UINT16(datalen+5);//³¤¶È
     46            for(i=0;i<datalen;i++)
     47            {
     48             pframe[8+i]= pdata[i];
     49             crc^=pframe[8+i];
     50            }//Êý¾Ý
     51            pframe[8+datalen]=crc;//Ð£Ñé
     52            return datalen+9;
     53            
     54          }
     55          
     56          void UnPackRC623Data(unsigned char *pbuf,RC623Frame_t *pframe)
     57          {
     58            unsigned char crc=0;
     59            unsigned char i=0;
     60            unsigned int len=0;
     61            //RC623Frame_t pframe;
     62            //AA BB 06 00 00 00 08 01 41 48
     63            if(pbuf[0]==0xAA)
     64              if(pbuf[1]==0xBB)
     65              {
     66                len=BUILD_UINT16(pbuf[2],pbuf[3]);
     67                for(i=4;i<(4+len-1);i++)//³¤¶ÈËãÉÏÁËCRC ¼õÈ¥1¸ö
     68                  crc^=pbuf[i];
     69                if(crc==pbuf[4+len-1])
     70                {
     71                  pframe->Comfirm=FRAME_CHECK_RIGHT;
     72                  pframe->Cmd=BUILD_UINT16(pbuf[6],pbuf[7]);
     73                  pframe->DataLen=len-5;//-cmd-desc-crc
     74                  for(i=0;i<pframe->DataLen;i++)
     75                  {
     76                    pframe->Data[i]=pbuf[8+i];
     77                  }
     78                }
     79                else
     80                  pframe->Comfirm=FRAME_CHECK_CRC_WRONG;
     81              }
     82            else
     83              pframe->Comfirm=FRAME_CHECK_HEAD_WRONG;
     84            //return pframe;
     85          }
     86          
     87          
     88          
     89          
     90                        
     91          #endif


 

 


Errors: none
Warnings: none
